{% extends 'tenant_foundation/tenant_base.html' %}
{% load staticfiles i18n %}

{% block title %}
{% trans 'Add New Partner | Workery' %}
{% endblock title %}

{% block header_content %}
{% endblock header_content %}

{% block content %}

<!-- CUSTOM JAVASCRIPT -->
<!----------------------------------------------------------------------------->
<script>
    /**
     *  DEVELOPERS NOTE:
     *  THE FOLLOWING JAVASCRIPT FUNCTIONS MUST BE DECLARED IF YOU WANT TO CALL
     *  THE "create_form.html" FORM TEMPLATE.
     */
    function click_cancel_button() {
        window.location = "{% url 'workery_tenant_partner_summary' %}";
    }

    function click_next_button() {
        ajax_post_form_submission("{% url 'workery_tenant_partner_confirm_create' %}");
    }
</script>
<!----------------------------------------------------------------------------->
<!-- end CUSTOM JAVASCRIPT -->


<!-- FORM WITH JS -->
<!----------------------------------------------------------------------------->
<script>
    /**
     *  When page loads, the following code will be run first.
     */
    $(document).ready(function () {
        // Initialize our datepicker jQuery code with our HTML view.
        $( "#birthdate" ).datepicker({
            dateFormat: 'yy-mm-dd',
            maxDate: 'today'
        });

        // Populate our 'select2' chosen values.
        var tmp_person_tags = localStorage.getObj("tmp_partner_person_tag_ids");
        $('#tags').val(tmp_person_tags);

        var tmp_company_tags = localStorage.getObj("tmp_partner_company_tag_ids");
        $('#organization_tags').val(tmp_company_tags);

        // Initialize our 'select2' element.
        $('#tags').select2();
        $('#organization_tags').select2();

        // Assign previously set values.
        $('#organization_name').val(localStorage.getItem("tmp_partner_company_name"));
        $('#organization_type_of').val(localStorage.getItem("tmp_partner_company_type"));
        $('#given_name').val(localStorage.getItem("tmp_partner_given_name"));
        $('#last_name').val(localStorage.getItem("tmp_partner_last_name"));
        $('#telephone').val(localStorage.getItem("tmp_partner_telephone"));
        $('#telephone_type_of').val(localStorage.getItem("tmp_partner_telephone_type_of"));
        $('#other_telephone').val(localStorage.getItem("tmp_partner_other_telephone"));
        $('#other_telephone_type_of').val(localStorage.getItem("tmp_partner_other_telephone_type_of"));
        $('#birthdate').val(localStorage.getItem("tmp_partner_date_of_birth"));
        $('#gender').val(localStorage.getItem("tmp_partner_gender"));
        $('#street_address').val(localStorage.getItem("tmp_partner_street_address"));
        $('#street_address_extra').val(localStorage.getItem("tmp_partner_street_address_extra"));
        $('#area_served').val(localStorage.getItem("tmp_partner_neighbourhood"));
        $('#address_locality').val(localStorage.getItem("tmp_partner_address_locality"));
        $('#address_region').val(localStorage.getItem("tmp_partner_address_region"));
        $('#address_country').val(localStorage.getItem("tmp_partner_address_country"));
        $('#postal_code').val(localStorage.getItem("tmp_partner_postal_code"));
        $('#post_office_box_number').val(localStorage.getItem("tmp_partner_post_office_box_number"));
        $('#email').val(localStorage.getItem("tmp_partner_email"));
        $('#telephone').val(localStorage.getItem("tmp_partner_telephone"));
        $('#password').val(localStorage.getItem("tmp_partner_password"));
        $('#password_repeat').val(localStorage.getItem("tmp_partner_password_repeat"));
        $('#description').val(localStorage.getItem("tmp_partner_description"));
        $('#comment').val(localStorage.getItem("tmp_residential_customer_comment"));

        // Radio buttons.
        $("input[name=is_ok_to_email][value=" + localStorage.getItem("tmp_partner_ok_to_email") + "]").prop('checked', true);
        $("input[name=is_ok_to_text][value=" + localStorage.getItem("tmp_partner_ok_to_text") + "]").prop('checked', true);
        $("input[name=is_active][value=" + localStorage.getItem("tmp_partner_is_active") + "]").prop('checked', true);

        // The following code continously checks to see if the current user
        // is assigned to the company.
        $('#organization_name').keypress(debounce(function (event) {
            // do the Ajax request
            var company_name = $('#organization_name').val();
            var email = $('#email').val();
        }, 250));

        // The following code continously checks to see if the current user
        // is assigned to the email.
        $('#email').keypress(debounce(function (event) {
            // do the Ajax request
            var email = $('#email').val();
            lookup_customer_by_email(email);
        }, 250));

    // This is to set default Phone type
    var phn_type = $('#telephone_type_of');
    phn_type.prop('selectedIndex', 0);

    // This is to set default other phone type
    var other_phn_type = $('#other_telephone_type_of');
    other_phn_type.prop('selectedIndex', 0);

    // THIS IS WHERE YOU CAN ADD YOUR COUNTRY/PROVINCE DROPDOWN JS CODE....
    $(function(){
      $('#address_country').change(function(){
        loadState($(this).find(':selected').val())
      });
      loadState('CA');
    });

    let c_dropdown = $('#address_country');
    c_dropdown.empty();
    c_dropdown.append('<option selected="true" disabled>Choose Country</option>');
    c_dropdown.prop('selectedIndex', 1);

    const state = "{% url 'workery_get_provinces_api_endpoint' %}?format=json";
    const country = "{% url 'workery_get_countries_api_endpoint' %}?format=json";

    console.log(state);
    console.log(country); // KANWAR - PLEASE IMPLEMENT.

    // Populate dropdown with list of countries
    $.getJSON(country, function (data) {
      $.each(data, function (key, entry) {
            c_dropdown.append($('<option></option>').attr('value', entry.code).text(entry.country));
      })
    });

    function loadState(countryId){
        let p_dropdown = $('#address_region');
        p_dropdown.empty();
        p_dropdown.append('<option selected="true" disabled>Choose State/Province</option>');
        p_dropdown.prop('selectedIndex', 0);

        // Populate dropdown with list of provinces
        $.getJSON(state, function (data) {
          $.each(data, function (key, entry) {
            if(entry.country == countryId){
                p_dropdown.append($('<option></option>').attr('value', entry.short).text(entry.name));
            }
          })
        });
        if(countryId == 'CA'){
            p_dropdown.prop('selectedIndex', 1);
        }
    }
    // end country/province dropdown function

	/**
	 *  Password Strength Check Validation.
	 */
	var checkPassword = document.getElementById("password");
	var s_letter = document.getElementById("s_lowercase");
	var s_capital = document.getElementById("s_uppercase");
	var s_character = document.getElementById("s_special");
	var s_length = document.getElementById("min_char");
	// When the user starts to type something inside the password field
	checkPassword.onkeyup = function() {
  		// Validate lowercase letters
  		var lowerCaseLetters = /[a-z]/g;
		  if(checkPassword.value.match(lowerCaseLetters)) {
		    s_letter.classList.remove("pass_check");
		    s_letter.classList.add("pass_valid");
		  } else {
		    s_letter.classList.remove("pass_valid");
		    s_letter.classList.add("pass_check");
		  }

  		// Validate capital letters
  		var upperCaseLetters = /[A-Z]/g;
		  if(checkPassword.value.match(upperCaseLetters)) {
		    s_capital.classList.remove("pass_check");
		    s_capital.classList.add("pass_valid");
		  } else {
		    s_capital.classList.remove("pass_valid");
		    s_capital.classList.add("pass_check");
		  }
  		// Validate numbers
  		var specialChar = /[!@#\$%\^&\*]/g;
		  if(checkPassword.value.match(specialChar)) {
		    s_character.classList.remove("pass_check");
		    s_character.classList.add("pass_valid");
		  } else {
		    s_character.classList.remove("pass_valid");
		    s_character.classList.add("pass_check");
		  }

  		// Validate length
		  if(checkPassword.value.length >= 8) {
		    s_length.classList.remove("pass_check");
		    s_length.classList.add("pass_valid");
		  } else {
		    s_length.classList.remove("pass_valid");
		    s_length.classList.add("pass_check");
		  }
	}

    }); // end Ready

    function lookup_customer_by_company_name_and_email(company_name, email) {

        //TODO: IMPLEMENT.

        // post_find_customer_matching(
        //     email,
        //     company_name,
        //     function(json_result) {
        //
        //         var count = Object.keys(json_result).length;
        //         console.log(count);
        //
        //         if (count > 0) {
        //             alert("Company already exists. Please pick another name or find the customer which holds that company and update the customer accordingly.");
        //
        //             //TODO: INTEGRATE THIS WITH THE COMPANY NAME FIELD.
        //         } // end COUNT > 0
        //
        //     },
        //     function(error_result) {
        //         console.log(error_result);
        //     }
        // );
    }

    function lookup_customer_by_email(email) {

        //TODO: IMPLEMENT.

        // post_find_customer_matching(
        //     email,
        //     null,
        //     function(json_result) {
        //
        //         var count = Object.keys(json_result).length;
        //         console.log(count);
        //
        //         if (count > 0) {
        //             alert("Email already exists. Please pick another email.");
        //
        //             //TODO: INTEGRATE THIS WITH THE EMAIL FIELD.
        //         } // end COUNT > 0
        //
        //     },
        //     function(error_result) {
        //         console.log(error_result);
        //     }
        // );
    }

    /**
     *  Function will unlock the submit button.
     */
    function disable_btn() {
        $('#id_submit_btn').val("{% trans 'Please Wait...' %}");
        $('#id_submit_btn').prop("disabled", true);
    }

    /**
     *  Function will lock the submit button.
     */
    function enable_btn() {
        $('#id_submit_btn').prop("disabled", false);
        $('#id_submit_btn').val("{% trans 'Update' %}");
    }

    function get_selected_radio_value(radiofields_name) {
        var radios = document.getElementsByName(radiofields_name);
        for (var i = 0, length = radios.length; i < length; i++) {
            if (radios[i].checked) {
                // only one radio can be logically checked, don't check the rest
                return radios[i].value;
            }
        }
        return null;
    }

    function valid_textfield_value(textfield_id, is_required, min_length) {
        var textfield = document.getElementById(textfield_id);
        var textfield_error = document.getElementById(textfield_id+'-error');
        var value = textfield.value;

        // CASE 1: BLANK FIELD.
        if (is_required) {
            if (value == '' || value == null || value == undefined || value.length == 0) {
                $('#'+textfield_id).addClass('border-primary').removeClass('border-success');
                textfield_error.innerHTML = "Field should not be blank.";
                return true; // This means that an error occured in validation.
            }
        }

        // CASE 2: MINIMUM LENGTH NOT MET.
        if (value.length > 0) {              // If user entered something...
            if (value.length < min_length) { // Validate that the minium was entered...
                $('#'+textfield_id).addClass('border-primary').removeClass('border-success');
                textfield_error.innerHTML = "Field requires a minimum of "+min_length+" characters.";
                return true;
            }
        }

        // Update the GUI to indicate this field has been updated.
        $('#'+textfield_id).addClass('border-success').removeClass('border-primary');

        // Return "false" which means no errors occured.
        return false;
    }

    function valid_radiofields_seleciton(radiofields_name, is_required) {
        var value = get_selected_radio_value(radiofields_name);
        var radiofield_error = document.getElementById(radiofields_name+'-error');

        if (is_required) {
            if (value == undefined || value === null || value.length == 0) {
                radiofield_error.innerHTML = "Please select option.";
                console.log(radiofields_name, "IS BLANK FIELD.");
                return true;
            }
        }

        // Return "false" which means no errors occured.
        return false;
    }

    function ajax_cancel(redirect_url) {
        window.location = redirect_url;
    }

    function ajax_post_form_submission(redirect_url) {
        save_submission(redirect_url);
    }

    /**
     *  Function to make text readable removing underscore and capitalizing
     */
    function humanize(str) {
    	var frags = str.split('_');
    	for (i=0; i<frags.length; i++) {
      		frags[i] = frags[i].charAt(0).toUpperCase() + frags[i].slice(1);
    	}
    	return frags.join(' ');
    }

    /**
     *  Function will validate the fields and then save them to the local
     *  storage, then direct user to the link in the 'redirect_url' variable.
     */
    function save_submission(redirect_url) {

        //----------------------------------------------------------------//
        //             EXTRACT THE DATA FROM THE FORM FIELDS.             //
        //----------------------------------------------------------------//

        // EXTRACT OUR FIELD VALUES AND SAVE THEM IN LOCAL STORAGE.
        var company_name = $('#organization_name').val();
        var company_type = $('#organization_type_of').val();
        var company_type_value = $('#companytype_id_'+company_type).text();
        var given_name = $('#given_name').val();
        var last_name = $('#last_name').val();
        var date_of_birth = $('#birthdate').val();
        if (date_of_birth !== undefined && date_of_birth != null && date_of_birth.length > 0) {
            var mydate = new Date(date_of_birth); // Convert "MM DD, YYYY" to JS DATE
            date_of_birth = mydate.toISOString().substring(0, 10); // Convert JS DATE to "YYYY-MM-DD"
        } else {
            date_of_birth = '';
        }
        var gender = $('#gender').val();
        if (gender == undefined || gender == null || gender.length == 0) {
            gender = '';
        }
        var ok_to_email = get_selected_radio_value('is_ok_to_email');
        var ok_to_text = get_selected_radio_value('is_ok_to_text');
        var street_address = $('#street_address').val();
        var street_address_extra = $('#street_address_extra').val();
        var neighbourhood = $('#area_served').val();
        var address_region = $('#address_region').val();
        if (address_region == null) {
            address_region = "Ontario";
        }
        var address_locality = $('#address_locality').val();
        var address_country = $('#address_country').val();
        if (address_country == null) {
            address_country = "Canada";
        }
        var postal_code = $('#postal_code').val();
        var post_office_box_number = $('#post_office_box_number').val();
        var email = $('#email').val();
        // var area_served = $('#id_area_served').val();
        var telephone = $('#telephone').val();
        var telephone_type_of = $('#telephone_type_of').val();
        // var telephone_extension = $('#id_telephone_extension').val();
        var other_telephone = $('#other_telephone').val();
        var other_telephone_type_of = $('#other_telephone_type_of').val();
        // var fax_number = $('#id_fax_number').val();
        var password = $('#password').val();
        var password_repeat = $('#password_repeat').val();
        var person_tags = $('#tags').val();
        var company_tags = $('#organization_tags').val();
        var description = $('#description').val();
        var comment = $('#comment').val();
        var is_active = get_selected_radio_value('is_active');

        //----------------------------------------------------------------//
        //             SAVE THE EXTRACTED DATA INTO LOCAL STORAGE         //
        //----------------------------------------------------------------//

        localStorage.setItem("tmp_partner_company_name", company_name);
        localStorage.setItem("tmp_partner_company_type", company_type);
        localStorage.setItem("tmp_partner_company_type_value", company_type_value);
        localStorage.setItem("tmp_partner_given_name", given_name);
        localStorage.setItem("tmp_partner_last_name", last_name);
        localStorage.setItem("tmp_partner_date_of_birth", date_of_birth);
        localStorage.setItem("tmp_partner_gender", gender);
        localStorage.setItem("tmp_partner_ok_to_email", ok_to_email);
        localStorage.setItem("tmp_partner_ok_to_text", ok_to_text);
        localStorage.setItem("tmp_partner_street_address", street_address);
        localStorage.setItem("tmp_partner_street_address_extra", street_address_extra);
        localStorage.setItem("tmp_partner_neighbourhood", neighbourhood);
        localStorage.setItem("tmp_partner_address_region", address_region);
        localStorage.setItem("tmp_partner_address_locality", address_locality);
        localStorage.setItem("tmp_partner_address_country", address_country);
        localStorage.setItem("tmp_partner_postal_code", postal_code);
        localStorage.setItem("tmp_partner_post_office_box_number", post_office_box_number);
        localStorage.setItem("tmp_partner_email", email);
        localStorage.setItem("tmp_partner_telephone", telephone);
        localStorage.setItem("tmp_partner_telephone_type_of", telephone_type_of);
        localStorage.setItem("tmp_partner_other_telephone", other_telephone);
        localStorage.setItem("tmp_partner_other_telephone_type_of", other_telephone_type_of);
        localStorage.setItem("tmp_partner_password", password);
        localStorage.setItem("tmp_partner_password_repeat", password_repeat);
        localStorage.setItem("tmp_partner_description", description);
        localStorage.setItem("tmp_residential_customer_comment", comment);
        localStorage.setItem("tmp_partner_is_active", is_active);

        // SAVE ARRAY OF IDS.
        localStorage.setObj("tmp_partner_person_tag_ids", person_tags);
        localStorage.setObj("tmp_partner_company_tag_ids", company_tags);

        // SAVE ARRAY OF VALUE ITEMS.
        var person_tags_arr = [];
        for (var i = 0; i < person_tags.length; i++) {
            var option_id = person_tags[i];
            var option_value = $('#person_tag_option_id_'+option_id).text();
            person_tags_arr.push(option_value);
        } // end FOR LOOP.
        localStorage.setObj("tmp_partner_person_tag_values", person_tags_arr);

        var company_tags_arr = [];
        for (var i = 0; i < company_tags.length; i++) {
            var option_id = company_tags[i];
            var option_value = $('#company_tag_option_id_'+option_id).text();
            company_tags_arr.push(option_value);
        } // end FOR LOOP.
        localStorage.setObj("tmp_partner_company_tag_values", company_tags_arr);

        //----------------------------------------------------------------//
        //      GENERATE RANDOM PASSWORD IF NO PASSWORD WAS ENETERED      //
        //----------------------------------------------------------------//

        // Generate random password and apply it automatically to the
        // password fields if no password was selected.
        password = localStorage.getItem("tmp_associate_member_password")
        password_repeat = localStorage.getItem("tmp_associate_member_password_repeat")
        if (password === undefined || password === null || password === '' || password.length == 0) {
            var randomString = Math.random().toString(34).slice(-10);
            randomString += "A";
            randomString += "!";
            password = randomString;
            password_repeat = randomString;
        }

        //----------------------------------------------------------------//
        //              VALIDATE ALL THE FIELDS IN THIS FORM              //
        //----------------------------------------------------------------//

        // MAKE OUR API CALL TO THE BACKEND TO "CREATE" THE CUSTOMER USER.
        partner_create_validate_api(
            {
                // --- PERSON ---
                'given_name': localStorage.getItem("tmp_partner_given_name"),
                'middle_name': null,
                'last_name': localStorage.getItem("tmp_partner_last_name"),
                'birthdate': localStorage.getItem("tmp_partner_date_of_birth"),
                'gender': localStorage.getItem("tmp_partner_gender"),
                'nationality': null,
                'is_ok_to_email': localStorage.getItem("tmp_partner_ok_to_email"),
                'is_ok_to_text': localStorage.getItem("tmp_partner_ok_to_text"),
                'address_country': localStorage.getItem("tmp_partner_address_country"),
                'address_locality': localStorage.getItem("tmp_partner_address_locality"),
                'address_region': localStorage.getItem("tmp_partner_address_region"),
                'extra_comment': null,
                'street_address': localStorage.getItem("tmp_partner_street_address"),
                'street_address_extra': localStorage.getItem("tmp_partner_street_address_extra"),
                'area_served': localStorage.getItem("tmp_partner_neighbourhood"),
                'postal_code': localStorage.getItem("tmp_partner_postal_code"),
                'post_office_box_number': localStorage.getItem("tmp_partner_post_office_box_number"),
                'email': localStorage.getItem("tmp_partner_email"),
                'fax_number': null,
                'telephone': localStorage.getItem("tmp_partner_telephone"),
                'telephone_type_of': localStorage.getItem("tmp_partner_telephone_type_of"),
                // 'telephone_extension': telephone_extension,
                'other_telephone': localStorage.getItem("tmp_partner_other_telephone"),
                'other_telephone_type_of': localStorage.getItem("tmp_partner_other_telephone_type_of"),
                // 'fax_number': fax_number
                'type_of': {{ tenant_constants.COMMERCIAL_CUSTOMER_TYPE_OF_ID }},
                'tags': localStorage.getObj("tmp_partner_person_tag_ids"),
                'description': localStorage.getItem("tmp_partner_description"),
                'extra_comment': localStorage.getItem("tmp_partner_comment"),

                // --- Account ---
                'password': password,
                'password_repeat': password_repeat,
                'is_active': localStorage.getItem("tmp_partner_is_active"),

                // --- ORGANIZATION ---
                'organization_name': localStorage.getItem("tmp_partner_company_name"),
                'organization_type_of': localStorage.getItem("tmp_partner_company_type"),
                'organization_address_country': localStorage.getItem("tmp_partner_address_country"),
                'organization_address_locality': localStorage.getItem("tmp_partner_address_locality"),
                'organization_address_region': localStorage.getItem("tmp_partner_address_region"),
                'organization_street_address': localStorage.getItem("tmp_partner_street_address"),
                'organization_street_address_extra': localStorage.getItem("tmp_partner_street_address_extra"),
                'organization_postal_code': localStorage.getItem("tmp_partner_postal_code"),
                'organization_post_office_box_number': localStorage.getItem("tmp_partner_post_office_box_number"),
                'organization_tags': localStorage.getObj("tmp_partner_company_tag_ids"),
            },
            function(result_dict) { // Success
                // FOR DEBUGGING PURPOSES ONLY.
                console.log(result_dict);

                // REDIRECT TO CONFIRM PAGE.
                window.location = redirect_url;
            },
            function(xhr,status,error) { // Error

                // STEP 1: Convert to JSON.
                var err = JSON.parse(xhr.responseText);

                // For debugging purposes only.
                console.log(err);

                // STEP 2: CLEAR EXISTING TEXT.
                $('#all_error_result').html("");
		$('#all_error_result').removeClass('error-block');

                // STEP 3: PRINT OUR ERROR IN THE TOP ERROR PANEL.
                for(var prop in err) {
                    if(err.hasOwnProperty(prop)) {
                        var val = err[prop];
                        var fdname = humanize(prop);

                        $('#all_error_result').append("<div class='form-error'><b>"+fdname+":</b> "+val+" </div>");
			$('#all_error_result').addClass('error-block');
			// Inline fields errors code
			$('#'+prop+'-error').html("<ul><li>"+val+"</li></ul>");
			$('#add-client-form').addClass('was-validated');
                    }
                }

                // STEP 4: FOCUS TO WHERE THE ERROR IS OCCURING.
                $('html, body').animate({ scrollTop: $('#id_page_title').offset().top }, 'slow');

                // STEP 5: ADD ERROR MESSAGES TO THE FIELDS.
                for(var prop in err) {
                    if(err.hasOwnProperty(prop)) {
                        var val = err[prop];
                        console.log("KEY", prop);
                        console.log("VALUE", val);

                        //TODO: IMPLEMENT - Attach the message to the field.
                    }
                }

            },
            function() { // Finally
                // UNLOCK THE "SUBMIT" BUTTON TO BE AVAILABLE FOR USAGE.
                enable_btn();
            }
        ); // end VALIDATE FUNC.

    } // end SUBMIT FUNCTION.

</script>
<!----------------------------------------------------------------------------->
<!-- end FORM WITH JS-->


<main id="main" role="main">

    <!-- BREADCRUMB -->
    <!------------------------------------------------------------------------->
    <nav aria-label="breadcrumb">
	  	<ol class="breadcrumb">
	    	<li class="breadcrumb-item"><a href="{% url 'workery_tenant_dashboard_master' %}"><i class="fas fa-tachometer-alt"></i>&nbsp;{% trans 'Dashboard' %}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'workery_tenant_partner_summary' %}"><i class="fas fa-handshake"></i>&nbsp;{% trans 'Partners' %}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{% trans 'Add' %}</a></li>
	  	</ol>
	</nav>
    <!------------------------------------------------------------------------->
    <!-- end BREADCRUMB -->

    <h1 id="id_page_title">{% trans 'Add Partner' %}</h1>

    <!-- FORM WITH HTML -->
    <!------------------------------------------------------------------------->
    <div class="col-sm-6 mx-auto mt-2">
        <!-- Residential form -->
        <div class="col-sm-12 fade show active" id="client-form" aria-labelledby="commercial">
            <p><span class="text-secondary font-italic"><sup>*</sup>&nbsp;-&nbsp;Indicates required field to fill out.</span></p>
            <!-- Error Output -->
            <div id="all_error_result" name="all_error_result" class="alert alert-error fade show" role="alert">
	    </div>
            <!-- end Error Output -->

            <form id="add-client-form" method="post" class="needs-validation" action="" novalidate>
            <!-- ############ PERSON ############ -->
            <p class="border-bottom mb-3 pb-1 text-secondary">Partner Contact</p>
            <p>Please fill in the account details for the company representative.</p>
            <div class="form-row">
                <div class="form-group col-md-12 mb-4">
                    <label for="given_name">Contact first name <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="given_name" name="given_name" placeholder="First name" minlength="3" required="" autofocus>
                    <div id="given_name-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="last_name">Contact last name <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="last_name" name="last_name" placeholder="Last name" minlength="3" required="">
                    <div id="last_name-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-8 mb-4">
                <label for="telephone">Phone 1 <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="telephone" name="telephone" placeholder="(xxx) xxx-xxxx" minlength="10" maxlength="14" required="">
                    <div id="telephone-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-4 mb-4">
                    <label for="telephone_type_of">&nbsp;</label>
                    <select class="custom-select form-control-lg border-primary" id="telephone_type_of" name="telephone_type_of" required="">
                        <option selected value="{{ shared_constants.WORK_CONTACT_POINT_TYPE_OF_ID }}">Work</option>
                        <option value="{{ shared_constants.TELEPHONE_CONTACT_POINT_TYPE_OF_ID }}">Landline</option>
                        <option value="{{ shared_constants.MOBILE_CONTACT_POINT_TYPE_OF_ID }}">Mobile</option>
                    </select>
                    <div id="telephone_type_of-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-8 mb-4">
                    <label for="other_telephone">Phone 2 (optional)</label>
                    <input type="text" class="form-control form-control-lg border border-success" id="other_telephone" name="other_telephone" placeholder="(xxx) xxx-xxxx" minlength="10" maxlength="14">
                    <div id="other_telephone-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-4 mb-4">
                    <label for="other_telephone_type_of">&nbsp;</label>
                    <select class="custom-select form-control-lg border-success" id="other_telephone_type_of" name="other_telephone_type_of">
                        <option selected value="{{ shared_constants.WORK_CONTACT_POINT_TYPE_OF_ID }}">Work</option>
                        <option value="{{ shared_constants.TELEPHONE_CONTACT_POINT_TYPE_OF_ID }}">Landline</option>
                        <option value="{{ shared_constants.MOBILE_CONTACT_POINT_TYPE_OF_ID }}">Mobile</option>
                    </select>
                    <div id="other_telephone_type_of-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="email">E-Mail&nbsp;<sup>*</sup></label>
                    <input type="email" class="form-control form-control-lg border border-primary" id="email" name="email" placeholder="Email Address">
                    <div id="email-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <p class="mb-1">Ok to E-Mail? <sup>*</sup></p>
                    <div class="form-radio custom-control custom-radio mb-2">
                        <input type="radio" id="is_ok_to_email" name="is_ok_to_email" value="yes" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_ok_to_email">Yes</label>
                    </div>
                    <div class="form-radio custom-control custom-radio">
                        <input type="radio" id="is_ok_to_email2" name="is_ok_to_email" value="no" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_ok_to_email2">No</label>
                        <div id="is_ok_to_email-error" class="invalid-feedback"></div>
                    </div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <p class="mb-1">Ok to Text? <sup>*</sup></p>
                    <div class="form-radio custom-control custom-radio mb-2">
                        <input type="radio" id="is_ok_to_text" name="is_ok_to_text" value="yes" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_ok_to_text">Yes</label>
                    </div>
                    <div class="form-radio custom-control custom-radio">
                        <input type="radio" id="is_ok_to_text2" name="is_ok_to_text" value="no" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_ok_to_text2">No</label>
                        <div id="is_ok_to_text-error" class="invalid-feedback"></div>
                    </div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="birthdate">Date of Birth</label>
                    <div class="input-group input-group-lg">
                        <input type="text" class="form-control form-control-lg border border-success" id="birthdate" name="birthdate" placeholder="yyyy-mm-dd" required>
                        <div class="input-group-append">
                            <span class="input-group-text dob-icon bg-success border-success"><i class="far fa-calendar-alt"></i></span>
                        </div>
                        <div id="birthdate-error" class="invalid-feedback"></div>
                    </div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="gender">Gender</label>
                    <select class="custom-select form-control-lg border-success" id="gender" name="gender" required>
                        <option value="" selected>Gender...</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="prefer not to say">Prefer not to say</option>
                    </select>
                    <div id="gender-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
      		        <label for="description" class="font-b6">Describe the client:</label>
      		        <textarea class="form-control form-control-lg border border-success" id="description" name="description" placeholder="Describe here..." rows="4" minlength="10" required></textarea>
      		        <div id="description-error" class="invalid-feedback"></div>
                    <small class="form-text text-muted">Maximum 1,000 characters.</small>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="tags">Tags (Person)</label>
                    <select id="tags" name="tags" class="form-control form-control-lg border border-success" name="states[]" multiple="multiple">
                    {% for tag in tags %}
                        <option value="{{ tag.id }}" id="person_tag_option_id_{{ tag.id }}">{{ tag }}</option>
                    {% endfor %}
                    </select>
                    <div id="tags-error" class="invalid-feedback"></div>
                </div>
            </div>
            <!-- ############ end PERSON ############ -->
            <!-- ############ COMPANY ADDRESS ############ -->
            <p class="border-bottom mb-3 pb-1 text-secondary">Company Details</p>
            <p>Please fill in the company details associated with the company representative.</p>
            <div class="form-row">
                <div class="form-group col-md-12 mb-4">
                    <label for="organization_name">Company name <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="organization_name" name="organization_name" placeholder="Company name" minlength="2" maxlength="30" required>
                    <div id="organization_name-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="organization_type_of">Company type <sup>*</sup></label>
                    <select class="custom-select form-control-lg border-primary" id="organization_type_of" name="organization_type_of" required="">
                        <option value="" selected="">Type...</option>
                        <option value="{{ tenant_constants.PRIVATE_ORGANIZATION_TYPE_OF_ID }}" id="companytype_id_{{ tenant_constants.PRIVATE_ORGANIZATION_TYPE_OF_ID }}">Private</option>
                        <option value="{{ tenant_constants.NON_PROFIT_ORGANIZATION_TYPE_OF_ID }}" id="companytype_id_{{ tenant_constants.NON_PROFIT_ORGANIZATION_TYPE_OF_ID }}">Non-Profit</option>
                        <option value="{{ tenant_constants.GOVERNMENT_ORGANIZATION_TYPE_OF_ID }}" id="companytype_id_{{ tenant_constants.GOVERNMENT_ORGANIZATION_TYPE_OF_ID }}">Government</option>
                    </select>
                    <div id="organization_type_of-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="street_address">Street Address <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="street_address" name="street_address" placeholder="Street Address" minlength="3" maxlength="255" required>
                    <div id="street_address-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="street_address_extra">Street Address (Extra)</label>
                    <input type="text" class="form-control form-control-lg border border-success" id="street_address_extra" name="street_address_extra" placeholder="Street Address (Extra)" minlength="3" maxlength="255">
                    <div id="street_address_extra-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="area_served">Neighbourhood (optional)</label>
                    <input type="text" class="form-control form-control-lg border border-success" id="area_served" name="area_served" placeholder="Neighbourhood" minlength="3">
                    <div id="area_served-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="address_locality">City <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="address_locality" name="address_locality" placeholder="City" minlength="3" maxlength="127" required>
                    <div id="address_locality-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="address_region">Province <sup>*</sup></label>
                    <select class="custom-select form-control-lg border-primary" id="address_region" name="address_region" required>
    		        </select>
                    <div id="address_region-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="address_country">Country <sup>*</sup></label>
                    <select class="custom-select form-control-lg border-primary" id="address_country" name="address_country" required>
    		        </select>
                    <div id="address_country-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="postal_code">Postal Code <sup>*</sup></label>
                    <input type="text" class="form-control form-control-lg border border-primary" id="postal_code" name="postal_code" placeholder="Postal Address" minlength="6" maxlength="6" required>
                    <div id="postal_code-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-7 mb-4">
                    <label for="post_office_box_number">Post Office Box # </label>
                    <input type="text" class="form-control form-control-lg border border-success" id="post_office_box_number" name="post_office_box_number" placeholder="Post Office Box #" minlength="3" maxlength="255" required>
                    <div id="post_office_box_number-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="organization_tags">Tags (Company)</label>
                    <select id="organization_tags" name="organization_tags" class="form-control form-control-lg border border-success" name="states[]" multiple="multiple">
                    {% for tag in tags %}
                        <option value="{{ tag.id }}" id="company_tag_option_id_{{ tag.id }}">{{ tag }}</option>
                    {% endfor %}
                    </select>
                    <div id="organization_tags-error" class="invalid-feedback"></div>
                </div>
            </div>
            <!-- ############ end COMPANY ADDRESS ############ -->
            <!-- ############ SECURITY ############ -->
            <p class="border-bottom mb-3 pb-1 text-secondary">Account</p>
            <div class="form-row">
                <div class="form-group col-md-12 mb-4">
      		      <label for="comment" class="font-b6">Additional Comments:</label>
      		      <textarea class="form-control form-control-lg border border-success" id="comment" name="comment" placeholder="Write any additional comments here..." rows="4" minlength="10" required></textarea>
      		      <div id="comment-error" class="invalid-feedback"></div>
                  <small class="form-text text-muted">Maximum 1,000 characters.</small>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="password">Password</label>
                    <input id="password"
                         name="password"
                  placeholder="{% trans 'Password' %}"
                        class="form-control form-control-lg border border-success"
                         type="password"
               autocapitalize="off"
                    minlength="2"
                    maxlength="30" required />
                    <div id="password-error" class="invalid-feedback"></div>
			 <small id="s_uppercase" class="pass_check form-text ft-indent">
			     Please enter a single upper case character.
			 </small>
			 <small id="s_lowercase" class="pass_check form-text ft-indent">
			     Please enter a single lower case character.
			 </small>
			 <small id="s_special" class="pass_check form-text ft-indent">
			     Please enter a single special character like !, @, #, %, ^, etc.
			 </small>
			 <small id="min_char" class="pass_check form-text ft-indent">
			     Password must contain atleast 8 characters.
			 </small>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <label for="password_repeat">Repeat Password</label>
                    <input id="password_repeat"
                         name="password_repeat"
                  placeholder="{% trans 'Repeat Password' %}"
                        class="form-control form-control-lg border border-success"
                         type="password"
               autocapitalize="off"
                    minlength="2"
                    maxlength="30" required />
                    <div id="password_repeat-error" class="invalid-feedback"></div>
                </div>
                <div class="form-group col-md-12 mb-4">
                    <p class="mb-1">Is active? <sup>*</sup></p>
                    <div class="form-radio custom-control custom-radio mb-2">
                        <input type="radio" id="is_active" name="is_active" value="true" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_active">Yes</label>
                    </div>
                    <div class="form-radio custom-control custom-radio">
                        <input type="radio" id="is_active2" name="is_active" value="false" class="custom-control-input form-check-input">
                        <label class="custom-control-label form-check-label" for="is_active2">No</label>
                        <div id="is_active-error" class="invalid-feedback"></div>
                    </div>
                </div>
            </div>
            <!-- ############ end SECURITY ############ -->
            <!-- end SUBMIT BUTTON -->
            <div class="form-group col-md-12 mb-3 p-0 mx-auto text-center">
                <button id="id_submit_btn"
                     class="btn btn-success btn-lg mt-4 float-right pl-4 pr-4"
                      type="button"
                   onclick="click_next_button();">
                    Next <i class="fas fa-arrow-right"></i></button>
                <button id="id_cancel_btn"
                     class="btn btn-orange btn-lg mt-4 float-left pl-4 pr-4"
                      type="button"
                   onclick="click_cancel_button();">
                    <i class="fas fa-times"></i>&nbsp;Back
                </button>
            </div>
            <!-- end SUBMIT BUTTON -->
        </div>
    </div>
    <!------------------------------------------------------------------------->
    <!-- end FORM WITH HTML-->


    <!-- RETURN-TO-TOP -->
    <a id="return-to-top" href="#" class="btn-info btn-lg back-to-top" role="button" title="Back to top"><i class="fas fa-angle-up fa-2x"></i></a>
    <!-- end RETURN-TO-TOP -->
</main>

{% endblock content %}
